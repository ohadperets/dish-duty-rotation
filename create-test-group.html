<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Test Group</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 15px 30px;
            font-size: 16px;
            background: #8b5cf6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background: #7c3aed;
        }
        .success {
            background: #10b981;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            color: white;
        }
        .error {
            background: #ef4444;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            color: white;
        }
    </style>
</head>
<body>
    <h1>Create Test Group for Join Testing</h1>
    <p>This will create a test group with:</p>
    <ul>
        <li>Group ID: <strong>99999</strong></li>
        <li>Name: Test Join Group</li>
        <li>Owner: test_user_123 (fake user)</li>
        <li>Dishwashers: Alice üë©, Bob üë®</li>
        <li>Both production and test environments</li>
    </ul>
    
    <button id="create-btn">Create Test Group 99999</button>
    <div id="status"></div>

    <script type="module">
        console.log('Script loaded!');
        
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        console.log('Firebase modules imported!');

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCux61f-LC3K_avjEWqVVpB5_gnS_q4VTk",
            authDomain: "dish-duty-rotation.firebaseapp.com",
            projectId: "dish-duty-rotation",
            storageBucket: "dish-duty-rotation.firebasestorage.app",
            messagingSenderId: "60848535960",
            appId: "1:60848535960:web:4e0c088cfab4a20c87b6fb"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        console.log('Firebase initialized!');

        const btn = document.getElementById('create-btn');
        console.log('Button element:', btn);
        
        btn.addEventListener('click', async () => {
            console.log('Button clicked!');
            const status = document.getElementById('status');
            status.innerHTML = '<div style="padding: 15px; background: #fbbf24; color: #000; border-radius: 8px;">Creating...</div>';

            try {
                const groupId = '99999';
                const fakeUserId = 'test_user_123';

                console.log('Creating group...');
                
                // 1. Create group
                await setDoc(doc(db, 'groups', groupId), {
                    groupId: groupId,
                    name: 'Test Join Group',
                    photoUrl: 'üéØ',
                    creatorUid: fakeUserId,
                    createdAt: serverTimestamp()
                });
                console.log('‚úÖ Group created');

                // 2. Create group membership
                await setDoc(doc(db, 'groupMembers', `${groupId}_${fakeUserId}`), {
                    groupId: groupId,
                    uid: fakeUserId,
                    role: 'creator',
                    joinedAt: serverTimestamp()
                });
                console.log('‚úÖ Membership created');

                // 3. Create production data
                await setDoc(doc(db, 'groupData_production', groupId), {
                    dishwashers: {
                        'Alice': 'üë©',
                        'Bob': 'üë®'
                    },
                    history: [],
                    lastUpdated: serverTimestamp()
                });
                console.log('‚úÖ Production data created');

                // 4. Create test data
                await setDoc(doc(db, 'groupData_test', groupId), {
                    dishwashers: {
                        'Alice': 'üë©',
                        'Bob': 'üë®'
                    },
                    history: [],
                    lastUpdated: serverTimestamp()
                });
                console.log('‚úÖ Test data created');

                status.innerHTML = `
                    <div class="success">
                        ‚úÖ Test group created successfully!<br><br>
                        <strong>Group Code: 99999</strong><br><br>
                        Now go to your app and click "Join Existing Group" and enter code: <strong>99999</strong>
                    </div>
                `;

            } catch (error) {
                console.error('Error:', error);
                status.innerHTML = `<div class="error">‚ùå Error: ${error.message}</div>`;
            }
        });
    </script>
</body>
</html>
